# [DriveAdapter: Breaking the Coupling Barrier of Perception and Planning   in End-to-End Autonomous Driving](https://arxiv.org/abs/2308.00398)

## What is the central research question or hypothesis that this paper addresses?

 Based on a quick skim of the paper, it seems the main goal is to propose a new paradigm for end-to-end autonomous driving that decouples the perception and planning components. 

Specifically, the paper explores utilizing a pre-trained "teacher" model that takes ground truth inputs to do the planning, while training a separate "student" model to only focus on perception and generate the inputs for the teacher model. This avoids having to train the planning component from scratch using behavior cloning, which can suffer from issues like causal confusion.

The main hypotheses appear to be:

- Directly feeding imperfect perceptual predictions from a student model into a teacher model will perform poorly due to the distribution gap between predicted and ground truth inputs.

- Adding adapter modules between the student and teacher, with objectives to align features, can help address this distribution gap in a layer-wise supervised manner.

- Further incorporating action guidance and masking during training can handle imperfections in the teacher model itself.

The proposed "DriveAdapter" model combines these ideas to achieve state-of-the-art performance on autonomous driving benchmarks. So the main hypothesis is that this paradigm of decoupling perception and planning with adapters can achieve better performance compared to end-to-end approaches that train both together.


## What is the main contribution of this paper?

 Based on my reading of the paper, here are the main contributions:

- The paper proposes a new paradigm called DriveAdapter for end-to-end autonomous driving. In this paradigm, a frozen teacher model pre-trained with reinforcement learning is directly utilized for planning and decision making. The student model focuses on perception by predicting the privileged inputs required by the teacher model. 

- To address the imperfect perception of the student model and imperfections in the teacher model, the paper introduces adapter modules between the student and teacher. These adapters employ masked feature alignment loss and action guidance loss to align the student's features with the teacher and inject safety priors.

- DriveAdapter achieves state-of-the-art performance on two closed-loop simulation benchmarks in CARLA. The results demonstrate the benefits of decoupling perception and planning and utilizing the driving knowledge within the teacher model.

- The paper provides extensive ablation studies and analysis to validate the proposed techniques. It also explores other attempts like directly generating intermediate features of the teacher model.

In summary, the key innovation is the proposed DriveAdapter paradigm and the adapter modules to enable a frozen teacher model to directly conduct planning while the student focuses on perception. This avoids issues like causal confusion in behavior cloning and allows leveraging the expertise of the teacher model.


## How does this paper compare to other research in the same field?

 Here are a few key points comparing this paper to other related research in end-to-end autonomous driving:

- This paper proposes a new "DriveAdapter" paradigm that decouples the perception and planning components, allowing the student model to focus solely on perception while utilizing the teacher model's planning knowledge. Most prior work uses a coupled approach where the student model learns both perception and planning via behavior cloning.

- DriveAdapter leverages adapter modules and masked feature alignment to align the student's imperfect perception with the teacher's expectation. This is a novel technique not explored in other end-to-end driving papers. It helps overcome the student's imperfect perception.

- Previous work like Roach relies on behavior cloning to transfer knowledge from the teacher to the student. This can lead to "causal confusion" where the student learns spurious correlations. By separating perception and planning, DriveAdapter avoids this downside.

- The intermediate BEV segmentation representation provides interpretability between perception and planning, unlike most end-to-end methods which are black boxes. This enables debugging perception failures.

- DriveAdapter achieves state-of-the-art performance on the CARLA benchmarks, demonstrating the benefits of the proposed approach. The techniques could be applicable to other end-to-end driving methods.

- The experiments also provide useful insights, like how directly predicting the teacher's middle layer features can work better than BEV segmentation. This could inform future research directions.

In summary, DriveAdapter introduces a new paradigm with novel techniques like masked feature adapters to advance end-to-end autonomous driving research. The thorough experiments and analysis also provide valuable insights to the community.


## What future research directions do the authors suggest?

 The paper does not explicitly suggest specific future research directions. However, based on my reading, some potential future research directions could include:

- Improving the teacher model to be more robust and make fewer mistakes, which would allow the student model to learn better policies. The authors mention the teacher model has imperfections that limit the overall performance.

- Exploring different intermediate representations between the perception and planning modules besides BEV segmentation. The authors experiment with predicting features at different layers of the teacher model and discuss pros/cons of BEV segmentation.

- Applying and evaluating the approach on real-world self-driving car platforms, not just in simulation. The authors mention sim-to-real as a future direction. 

- Developing better techniques to handle the distribution gap between predicted and ground truth inputs to the teacher model. The adapters help but don't completely solve this.

- Experimenting with different teacher and student model architectures tailored for this paradigm.

- Collecting larger and more diverse self-driving datasets to train the models. The authors show benefits of 10x more data.

In general, further work on the teacher-student paradigm with frozen teacher networks seems promising, as well as addressing limitations of the current approach. But the authors do not provide an explicit roadmap for future work.


## Summarize the paper in two paragraphs.

 Here is a two paragraph summary of the paper:

The paper presents DriveAdapter, a new approach for end-to-end autonomous driving. DriveAdapter utilizes a frozen teacher model that was pre-trained with reinforcement learning on privileged inputs to directly make planning decisions. This avoids issues like causal confusion that can occur with behavior cloning methods. However, feeding the imperfect perception predictions from the student model directly into the teacher model performs poorly due to the distribution gap between the prediction and ground truth inputs the teacher model was trained on. 

To address this, DriveAdapter employs adapter modules between the student and teacher models. The adapters have two types of losses - a feature alignment loss that aligns the student features with the ground truth features, and an action loss that provides supervision when the teacher model makes mistakes. A masking strategy is used for the feature alignment loss in cases where the teacher model is overridden by rules. Experiments show DriveAdapter achieves state-of-the-art performance on two autonomous driving benchmarks in CARLA compared to prior methods. Ablations verify the adapter design choices and loss functions are critical for performance.


## Summarize the paper in one paragraph.

 Here is a one paragraph summary of the paper:

The paper proposes DriveAdapter, a new method for end-to-end autonomous driving that decouples the learning of perception and planning. It utilizes a frozen teacher model that was pre-trained with reinforcement learning on privileged information to directly conduct planning, while the student model focuses on perception from raw sensor inputs. To address the gap between the student's imperfect perception and the teacher's expectation of ground truth inputs, DriveAdapter employs adapter modules with masked feature alignment losses. It also handles imperfections in the teacher model by masking the alignment loss and backpropagating an action loss when the teacher model's output is overridden by rules. Experiments in the CARLA simulator show state-of-the-art performance on two benchmarks. The decoupled paradigm avoids issues like causal confusion in behavior cloning while benefiting from the teacher's driving knowledge. The interpretable BEV segmentation task enables debugging perception failures. Overall, DriveAdapter advances end-to-end autonomous driving by enabling the student model to focus on perception while directly leveraging the teacher's planning expertise.


## Summarize the main method used in the paper in one paragraph.

 Based on my reading of the paper, the main method involves an end-to-end autonomous driving system called DriveAdapter that utilizes a frozen pre-trained teacher model for planning while allowing a student model to focus on perception learning. Specifically, the student model takes in raw sensor data and generates a bird's-eye view (BEV) segmentation, which is fed into the frozen teacher model along with adapter modules. The adapters align the features from the student model to the ground truth features that the teacher expects through a masked feature alignment loss. This allows the system to benefit from the teacher's driving knowledge while overcoming imperfections in the student's perception and the teacher's own limitations. An action loss is also used to inject hand-crafted rule priors and override the teacher model when needed. By decoupling the perception and planning this way, the system avoids issues like causal confusion from end-to-end behavior cloning while achieving state-of-the-art performance on autonomous driving benchmarks.

# [Functorial String Diagrams for Reverse-Mode Automatic Differentiation](https://arxiv.org/abs/2107.13433)

## What is the central research question or hypothesis that this paper addresses?

Based on my reading, the main research contributions of this paper are:1. Developing a new calculus of hierarchical string diagrams suitable for representing closed monoidal (and cartesian closed) categorical structure. 2. Formulating and proving the correctness of an automatic differentiation algorithm for simply typed lambda calculus using this hierarchical string diagram calculus.3. Defining hierarchical hypergraphs called "hypernets" that provide a concrete representation of hierarchical string diagrams amenable to implementation via graph rewriting.More specifically, some key aspects of the research presented:- The paper introduces a formal language of hierarchical string diagrams that can represent abstraction via nested diagrams. This provides a graphical syntax for cartesian closed categories.- An automatic differentiation algorithm is presented that operates on hierarchical string diagrams. The algorithm's correctness for first-order terms is proven using the properties of reverse derivative categories. - Hierarchical hypergraphs called hypernets are defined and shown to be a sound and complete representation of hierarchical string diagrams. This enables implementing the AD algorithm via double-pushout graph rewriting.So in summary, the core hypothesis is that hierarchical string diagrams provide a suitable graphical language for formulating and proving correct an AD algorithm, and that hypernets give a representation allowing efficient implementation. The contributions provide evidence for this claim.


## What is the main contribution of this paper?

Based on my understanding, the main contributions of this paper are:1. It develops a new hierarchical string diagram calculus suitable for representing closed monoidal (and cartesian closed) categorical structure. This provides a convenient graphical language for reasoning about concepts like abstraction and application.2. It formulates an automatic differentiation algorithm for applied simply typed lambda calculus in this hierarchical string diagram language. This is based on the influential reverse mode AD algorithm of Pearlmutter & Siskind 2008, but proves its soundness for the first time. 3. It defines a class of hierarchical hypergraphs called "hypernets" that provide a sound and complete representation of hierarchical string diagrams. This allows the AD algorithm to be implemented via efficient double pushout graph rewriting of hypernets.In summary, the paper introduces an innovative hierarchical string diagram language that enables clearer formulation and soundness proof of a higher-order reverse mode AD algorithm, along with a graph rewriting representation to enable efficient implementation. The combination of these three topics showcases the value of hierarchical string diagrams and hypergraphs for reasoning about and implementing sophisticated program transformations like automatic differentiation.


## What is the TL;DR (Too Long, Didn't Read) version of the paper? If you had to summarize it in one sentence, what would that be?

Here is a one sentence summary of the key points in the paper:The paper introduces a hierarchical calculus of string diagrams to formulate and prove correct an automatic differentiation algorithm, with applications to machine learning, and shows how to efficiently implement it via hierarchical hypergraph rewriting.


## How does this paper compare to other research in the same field?

Here are some thoughts on how this paper compares to other related research:- The use of hierarchical string diagrams to represent monoidal closed/cartesian closed structure seems novel. Previous work on string diagrams for closed categories like Baez and Stay's "Physics, Topology, Logic and Computation" focused more on compact closed categories. This paper provides the first fully detailed hierarchical string diagram calculus for cartesian closed categories.- The algorithm for automatic differentiation of higher-order terms is clearly inspired by and simplifies Pearlmutter and Siskind's seminal work on reverse-mode AD for functional programs. However, it focuses just on a simply-typed calculus without effects or recursion. Compared to other recent work on AD correctness like Vakar's, it has a simpler treatment of function space tangents.- Representing hierarchical string diagrams as hypergraphs/hypernets builds on a line of work connecting string diagrams and graph rewriting, like the seminal papers of Bonchi et al. But the specifics of the hierarchical hypergraph representation seem novel, as do the theorems connecting equivalence of string diagrams and isomorphism of hypernets.- The overall combination of using hierarchical string diagrams both to design the AD algorithm and prove it correct seems innovative. Previous work on AD correctness relied more on semantic models and denotational proofs. The graphical proofs here feel more intuitive. - Compared to related graphical languages for calculi with explicit substitutions like sharing graphs, string diagrams are more syntactic/algebraic and less focused on implementation concerns like cost models.So in summary, while the paper leverages a lot of related work, the specific hierarchical string diagram calculus, the simplicity of the graphical AD algorithm and proofs, and the hypernet representation all seem like novel contributions advancing the state of the art. The unification of graphical reasoning about AD, explicit substitutions, and graph rewriting is creative.


## What future research directions do the authors suggest?

The paper suggests several future research directions:- Extending the hierarchical string diagram calculus to handle other features common in programming languages like mutable state, continuations, etc. They mention tracing as one possible direction to handle effects. - Implementing the automatic differentiation algorithm by translating the string diagram rewrites to double-pushout rewriting of hypernets. This could allow integration into practical compilers.- Applying the hierarchical string diagram notation and proof techniques to other challenging language features like effects. The paper suggests closures are particularly important here.- Further investigation of quantitative models of computation using hierarchical hypergraphs, inspired by work on sharing graphs. This could lead to resource-aware models.- Exploring the untapped potential of graph-like representations for syntax outside compiler engineering. The paper cites some prior examples like interaction nets.- Connections to other graphical languages like proof nets, especially in the case of extending to linear logic and related settings.So in summary, the main future directions mentioned are: implementations and applications of the techniques introduced here, especially to automatic differentiation; extending the approach to other language features like effects; and further exploration of the benefits of graph-like syntax representations.


## Summarize the paper in one paragraph.

The paper presents a functorial string diagram calculus for expressing reverse-mode automatic differentiation (AD) algorithms and proving their correctness. The key ideas are:- A new hierarchical string diagram syntax is introduced to represent lambda calculus terms with explicit substitutions. This provides a convenient graphical representation of closures which are important for higher-order AD algorithms.- An AD algorithm inspired by Pearlmutter & Siskind (2008) is formulated as rewrite rules on the hierarchical string diagrams. The rules implement forward and reverse passes to transform a function into a new function that computes derivatives. - The soundness of the AD algorithm is proven using properties of reverse derivative categories. A key result shows the rewritten string diagrams compute correct derivatives for functions with first-order input and outputs, even if they contain higher-order terms.- Hierarchical hypergraphs called "hypernets" are defined as a graph representation of the hierarchical string diagrams. It is shown hypernet rewriting corresponds exactly to string diagram rewriting, enabling implementation via double-pushout graph rewriting.Overall, the three main contributions are: 1) hierarchical string diagrams for representing AD algorithms, 2) soundness proof for the AD algorithm, and 3) hypernets as a graph representation to enable implementation. The graphical syntax and hypernet representation are argued to simplify reasoning and implementation of AD systems.


## Summarize the paper in two paragraphs.

Here is a two paragraph summary of the paper:This paper introduces a new graphical language called hierarchical string diagrams for representing and reasoning about programs involving higher-order functions and automatic differentiation. The key novelty is the addition of hierarchical features to regular string diagrams for monoidal categories, which allows representing closed monoidal and cartesian closed structure. The authors use this language to formulate an automatic differentiation algorithm inspired by Pearlmutter and Siskind 2008, and prove its soundness for the first time. A main benefit of the hierarchical string diagrammatic language is that it simplifies the reasoning and makes the soundness proof more accessible. To enable implementation, the authors further establish a correspondence between hierarchical string diagrams and hierarchical hypergraphs. They introduce hypernets, a subclass of hierarchical hypergraphs that forms a sound and complete representation of the hierarchical string diagrams. This allows leveraging the well-established framework of double-pushout graph rewriting to implement the hierarchical string diagram transformations underlying the AD algorithm. Overall, the paper showcases the utility of hierarchical string diagrams and hypergraphs for representing, reasoning about, and implementing algorithms involving higher-order functions.


## Summarize the main method used in the paper in one paragraph.

The main method used in this paper is the development of a hierarchical string diagram calculus and its connection to automatic differentiation. Specifically:- The authors develop a new syntax of hierarchical string diagrams that can represent closed monoidal and cartesian closed categories. This involves introducing labelled frames to represent mappings between morphisms in different categories, and using abstraction boxes to represent function abstraction. - Using this diagrammatic language, they formulate an automatic differentiation algorithm inspired by Pearlmutter and Siskind 2008. The algorithm has forward and reverse passes transformated by colored boxes around diagrams. They prove this algorithm is compatible with Beta reduction.- To give an implementation of the AD algorithm, the authors introduce hierarchical hypergraphs called hypernets. They show hypernets give a sound and complete representation of hierarchical string diagrams modulo symmetric monoidal laws. This allows implementing the AD algorithm as double-pushout rewriting of hypernets.So in summary, the main novelty is using hierarchical string diagrams to formulate the AD algorithm and prove it correct on simply typed lambda terms, plus giving an implementation via hierarchical hypergraph rewriting. The diagrammatic language provides an intuitive syntax to express the algorithm and enable simpler proofs.

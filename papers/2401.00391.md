# [Controllable Safety-Critical Closed-loop Traffic Simulation via Guided   Diffusion](https://arxiv.org/abs/2401.00391)

## Write a very high-quality and detailed summary of the paper that describes the paper in a way that a human can fully understand. The summary should cover the problem, the proposed solution and highlight the main contributions of the paper.

 Here is a detailed summary of the paper:

Problem:
Evaluating the safety and robustness of autonomous vehicle (AV) planning algorithms requires testing them in challenging, safety-critical driving scenarios. However, manually designing such scenarios is laborious and lacks scalability. While some works have focused on automatically generating adversarial scenarios, they typically do not simulate closed-loop interactions where all agents react to each others' behaviors over time. This lacks realism and fails to fully assess an AV system's capabilities. Moreover, existing methods offer limited control over the characteristics of generated scenarios.

Proposed Solution:
This paper introduces a framework for controllable, closed-loop simulation of realistic traffic scenarios to evaluate AV planning algorithms. The key components are:

1) A novel test-time guidance strategy for trajectory diffusion models that nudges generated behaviors towards safety-critical situations. This is done by incorporating adversarial objectives like maximizing collision risk into the diffusion model's sampling process. 

2) New guidance functions based on route adherence and collision avoidance that improve scene consistency and realism over long simulations.

3) An adversarial agent modeled within the reactive traffic simulation, governed by an adversarial loss term that specifically targets the AV under test. The adversarial loss balances collision goals with regularization for realistic behavior.

4) The remaining non-adversarial agents exhibit fully closed-loop reactivity, responding to the ego AV's actions through re-planning, enabling comprehensive safety assessment.

Contributions:

- Demonstrates enhanced control over scenario criticality and adversary behavior compared to prior work, while preserving realism.

- Introduces novel guidance strategies for long-term scene consistency in interactive simulation using diffusion models.

- Formulates a closed-loop framework where all agents mutually influence each others' reactions over time.

- Can simulate extended scenarios without constraints from pretrained traffic models, enabling exhaustive AV testing.

- Evaluated on nuScenes dataset, the method shows improved performance in managing scene consistency and collision rate control compared to baseline approaches.

The proposed controllable, closed-loop simulation paradigm significantly advances testing and evaluation capabilities for AV systems to improve safety and reliability.

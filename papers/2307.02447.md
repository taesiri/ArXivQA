# [Using Rewrite Strategies for Efficient Functional Automatic   Differentiation](https://arxiv.org/abs/2307.02447)

## What is the central research question or hypothesis that this paper addresses?

Based on my reading of the paper, the main research question seems to be:How can we combine the elegance of automatic differentiation using dual numbers with efficient optimization via rewrite strategies?The key ideas and contributions appear to be:- Implementing automatic differentiation for a functional array programming language using dual numbers, which is conceptually clean.- Expressing optimizations on the differentiated programs as rewrite rules.- Controlling the application of rewrite rules using a strategy language to explore different optimization schedules.- Providing evidence via a microbenchmark that this approach can lead to asymptotically faster programs compared to unoptimized code.The motivation seems to be leveraging the benefits of dual numbers for automatic differentiation, while addressing the efficiency challenges via rewrite rule optimizations guided by strategies. The authors aim to demonstrate the viability of this approach on a simple array programming language.In summary, the central hypothesis appears to be that rewrite strategies can enable efficient optimization of automatic differentiation implemented via dual numbers in functional languages. The paper aims to provide a proof of concept for this approach.


## What is the main contribution of this paper?

Based on my reading, the main contribution of this paper seems to be using rewrite strategies for efficient automatic differentiation (AD). Specifically:- The paper implements AD for a functional array programming language using dual numbers, which provides an elegant and conceptually simple approach to differentiation. - To optimize the efficiency of the AD implementation, the paper leverages rewrite rules and strategy combinators. This allows fine-grained control over the schedule of applying optimizations, which can have significant impact as optimizations often enable further optimizations.- The rewrite rules and strategies are implemented in the Lean programming language. This allows combining the elegance of dual numbers-based AD with optimization strategies in a functional setting.- A microbenchmark is presented that shows the impact of optimizations, with the optimized AD program outperforming unoptimized AD and handwritten code. This demonstrates the potential benefits of using strategies for AD optimization.In summary, the key contribution seems to be exploring the synergy between dual numbers AD, rewrite strategies for optimization, and functional programming in Lean. This is presented as a novel approach to balancing correctness, clarity and performance for differentiable programming.


## What is the TL;DR (Too Long, Didn't Read) version of the paper? If you had to summarize it in one sentence, what would that be?

Here is a one sentence summary of the key points from the paper:The paper introduces an approach to automatic differentiation using dual numbers and rewrite strategies, demonstrating the viability of combining elegant mathematical foundations with fine-grained control over optimization scheduling to achieve performant code generation.


## How does this paper compare to other research in the same field?

Here are a few key ways this paper compares to other related research on differentiable programming and automatic differentiation:- It focuses specifically on implementing automatic differentiation (AD) in a functional array programming language, whereas much existing work has focused on imperative languages like Python. Using a functional language allows exploiting properties like referential transparency for optimization.- The approach is based on dual numbers, a common technique in functional AD implementations. This provides conceptual simplicity and aids correctness proofs. Other techniques like reverse-mode AD can be more complex to implement compositionally. - A key novelty is the use of rewrite rules and strategy combinators for optimizing the differentiated programs. This allows flexible control and ordering of optimizations, which can be important as optimizations depend on each other. Other AD frameworks typically use fixed sets of optimizations.- The implementation is embedded in the Lean proof assistant. This enables the use of dependent types to encode size information and prevent errors. Formal verification of the AD transformation could also be possible in the future.- It demonstrates the viability of the approach on a simple microbenchmark, showing asymptotic speedups compared to unoptimized code. But there is no comparison to state-of-the-art AD frameworks. More complex evaluation on ML models would be needed to determine competitiveness.In summary, the paper explores a novel synthesis of functional programming, dependent types, rewrite strategies and AD. It aims to combine advantages from each area. The paper offers initial evidence for the potential of this approach, but substantially more evaluation is needed to determine how it compares to existing imperative AD frameworks for larger ML models and benchmarks. Formal verification also remains future work.


## What future research directions do the authors suggest?

Based on my reading of the paper, some of the main future research directions suggested by the authors are:- Exploring more complex optimization strategies beyond the basic combinators presented. The authors mention strategies involving general recursion, non-determinism, and strategies parameterized by meta-level information. This could allow expressing more powerful program optimizations.- Applying the approach to other application domains beyond machine learning and automatic differentiation. The generality of term rewriting systems and strategy languages means they could likely be useful for optimizing programs in many domains.- Investigating alternate strategy languages and ways of expressing rewrite rules. The authors use a simple first-order functional language to represent their strategies, but other languages like Stratego may be worth exploring.- Formally verifying the correctness of optimizations expressed as rewrite rules. The authors mention this as important future work. The fact that rules are explicitly specified aids verification.- Developing larger benchmarks and examples to further demonstrate the utility of the approach. The paper currently includes a simple microbenchmark. More complex end-to-end examples could reveal new challenges.- Exploring the interaction between rewrite rules and other compiler optimizations. Applying rules greedily may limit later optimizations, so principled ways to schedule optimizations are needed.In summary, the authors highlight opportunities to expand the expressiveness and domains of application for strategy-based program optimization, as well as many open research problems related to verification, scheduling, and evaluation on larger programs. Overall, the paper proposes a promising new approach to program optimization that warrants significant further research.


## Summarize the paper in one paragraph.

Here is a one paragraph summary of the main points from the paper:The paper presents an implementation of automatic differentiation (AD) in a functional array programming language using rewrite rules and strategy combinators for optimization. The authors implement AD based on dual numbers, which bundles values with their derivatives, in a typed embedded domain specific language (DSL). Using the flexibility of rewrite strategies, they are able to optimize the generated code by applying transformations such as removing intermediate bindings and avoiding unnecessary array constructions. The optimizations are defined as rewrite rules which are controlled by strategy combinators. The authors argue that this allows elegantly combining the conceptual simplicity of functional AD with optimizations tuned for machine learning workloads. They provide evidence for the viability of their approach through a micro-benchmark on a trivial program, demonstrating asymptotic speedups compared to an unoptimized baseline. Overall, the paper aims to show the potential of using rewrite strategies to optimize functional AD code.


## Summarize the paper in two paragraphs.

Here is a summary of the paper in two paragraphs:The paper describes using rewrite strategies for efficient functional automatic differentiation (AD). AD allows computing the derivative of a program automatically. Implementations based on dual numbers are conceptually elegant but inefficient, as the gradient is computed one entry at a time. To optimize a dual numbers AD implementation, the paper applies rewrite rules using a strategy language. Strategies provide fine-grained control over rule application order.  The authors implement an array language in Lean and define rewrite rules inspired by previous work. Strategies are functions in Lean combined through higher-order combinators. Traversal strategies allow rewriting subterms. On a microbenchmark, optimizing via strategies leads to asymptotic speedups over an unoptimized baseline, demonstrating the approach's potential. The combination of dual numbers AD and strategy-based optimization aims to leverage the elegance of the former and optimization power of the latter.


## Summarize the main method used in the paper in one paragraph.

Here is a one paragraph summary of the main method used in the paper:The paper implements automatic differentiation (AD) in a functional array programming language using rewrite rules and strategy combinators for optimization. The authors use an embedded domain-specific language (DSL) in Lean that features dependent types to track array sizes. Differentiation is implemented via a dual numbers transformation that replaces real numbers with pairs of reals representing primal and derivative values. To recover efficiency, the authors apply optimization rewrite rules adapted from prior work and control their application using strategies inspired by term rewriting systems. Strategies are functions that transform terms, possibly failing, and can be combined using higher-order combinators. The flexibility of strategies allows exploring different optimization schedules. The authors demonstrate the viability of their approach through a microbenchmark that shows asymptotic speedups from optimization compared to unoptimized and handwritten baselines. The main contribution is using rewrite strategies to optimize functional AD implemented via dual numbers in a typed DSL, aiming to combine conceptual simplicity with performance.
